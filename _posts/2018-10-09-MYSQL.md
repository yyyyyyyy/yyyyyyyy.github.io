---
layout: post
date:   2018-10-04 13:36:31 +0800
categories: 
---
## 表类型(存储引擎)的选择

### MySQL存储引擎概述
MySQL支持多种存储引擎,在处理不同类型的应用时,可以通过选择使用不同的存储引擎提高应用的效率,或者提供灵活地存储.
MySQL的存储引擎包括:MyISAM、InnoDB、BDB、MEMORY、MERGE、EXAMPLE、NDB、Cluster、ARCHIVE、CSV、BLACKHOLE、FEDERATED等，
其中InnoDB和BDB提供事务安全表，其他存储引擎都是非事务安全表。

### 各种存储引擎的特性
最常用的2种引擎：

* Myisam是MySQL的默认存储引擎，当create创建新表时，未指定新表的存储引擎时，默认使用Myisam。每个MyISAM在磁盘上存储成3个文件。文件名都和表明相同，扩展名分别是.frm(存储表定义)、.MYD(MYData,存储数据)、.MYI(MYIndex,存储索引)。数据文件和索引文件可以放置在不同的目录，平均分布io，获得更快的速度。
* InnoDB存储引擎提供了具有提交、回滚和崩溃恢复能力的事务安全。但是对比Myisam的存储引擎，InnoDB写的处理效率差一些并且会占用更多的磁盘空间以保留数据和索引。

### 如何选择合适的存储引擎
选择标准：根据应用特点选择合适的存储引擎，对于复杂的应用系统可以根据实际情况选择多种存储引擎进行组合。

* Myisam：默认的MySQL插件式存储引擎，它是在Web、数据仓储和其他应用环境下最常使用的存储引擎之一。
* InnoDB：用于事务处理应用程序，具有众多特性，包括ACID事务支持。
* Memory：将所有数据保存在RAM中，在需要快速查找引用和其他类似数据的环境下，可以提供极快的访问。
* Merge：允许MySQL DBA或开发人员将一系列等同的MyISAM表以逻辑方式组合在一起，并作为一个对象引用他们。对于诸如数据仓储等VLDB环境十分适合。

### 选择合适的数据类型
选择数据类型的基本原则,前提是使用适合存储引擎，根据选定的存储引擎，确定如何选择合适的数据类型。

* MyISAM数据存储引擎和数据列：MyISAM数据表，最好使用固定长度的数据列代替可变长度的数据列。
* MEMORY存储引擎和数据列：MEMORY数据表目前都使用固定长度的数据行存储，因此无论使用CHAR或VARCHAR列都没有关系。两者都是作为CHAR类型处理的。
* InnoDB存储引擎和数据列：建议使用VARCHAR类型，对于InnoDB数据表，内部的行存储合适没有区分固定长度和可变长度列（所有数据行都使用指定数据列值的头指针），因此在本质上，使用固定长度的CHAR列不一定比使用可变长度VARCHAR列简单》因而，主要的性能因素是数据行使用的存储总量。由于CHAR平均占用的空间多于VARCHAR，因此使用VARCHAR来最小化需要处理的数据行的存储总量和磁盘I/O是比较好的。

## 固定长度数据列与可变长度的数据列

### char与varchar
* char和VARCHAR类型类似，但他们保存和检索的方式不同。
* 他们最大长度和是否尾部空格被保留等方面也不同。
* 在存储或检索过程中不进行大小写转换。

### text和blob
在使用text和blob字段类型时要注意以下几点，以便更好的发挥数据库的性能。

* blob和text值也会引起自己的一些问题，特别是执行了大量的删除或更新操作的时候。删除这种值会在数据表中留下很大的“空洞”，以后填入这些“空洞”的记录可能长度不同，为了提高性能，建议定期使用optimize table功能对这类表进行碎片整理。
* 使用合成的（synthetic）索引，合成的索引列在某些时候是有用的。
* 在不必要的时候避免检索大型的blob或text值。
* 把blob或text列分离到单独的表中。

### 浮点数和定点数
* 在MySQL中flout、double（或real）是浮点数，decimal（或numberic）是定点数。
* 浮点数相对于定点数的优点是在长度一定的情况下，浮点数能够表示更大的数据范围，它的缺点是会引起精度问题。


## 字符集
字符集是一套符号和编码的规则，不论是在oracle数据库还是在MySQL数据库，都存在字符集的选择问题，而且如果在数据库创建阶段没有正确选择字符集，那么可能再后期需要更换字符集，而字符集的更换是代价比较高的操作，也存在一定的风险，所以，我们推荐在应用开始阶段，就按照需求正确的选择合适的字符集，避免后期不必要的调整。
### MySQL支持的字符集简介
MySQL服务器可以支持多种字符集，在用一台服务器、同一个数据库、甚至同一个表的不同字段都可以指定使用不同的字符集，相比oracle等其他数据库管理系统，在同一个数据库只能使用相同的字符集，MySQL明显存在更大的灵活性。MySQL的字符集包括字符集和校对规则两个概念。字符集是用来定义MySQL存储字符串的方式，校对规则则是定义了比较字符串的方式。字符集和校对规则是一对多的关系，MySQL支持30多种字符集的70多种校对规则。每个字符集至少对应一个校对规则。可以用show collation like‘utf8%’；命令常看相关字符集的校对规则。

## Unicode简述
### MySQL字符集的设置
MySQL的字符集和校对规则有4个级别的默认设置：服务器级、数据库级、表级和字段级。分别在不同的地方设置，作用也不相同。

* 服务器字符集和校对，在MySQL服务器启动的时候确定。
* 可以在my.cnf中设置。
* 或在启动选项中指定。
* 或者在编译的时候指定。

## 索引的设计和使用

### MySQL索引概述
所有MySQL列类型可以被索引.对相关列使用索引是提高select操作性能的最佳途径。根据存储引擎定义每个表的最大索引数和最大索引长度。所有存储引擎支持每个表至少16个索引，总索引长度至少为256字节。大多数存储引擎有更高的限制。

设计索引的原则：

* 搜索的索引列，不一定是所要选择的列。
* 使用唯一索引。
* 使用短索引。
* 利用最左前缀。
* 不要过度索引。每个额外的索引都要占用额外的磁盘空间，并降低写操作的性能。

### btree索引与hash索引
对于btree和hash索引，当使用=、in、is null等操作符时，关键元素与常量值的比较关系对应一个范围条件。hash索引还有一些其他特征：它们只用于=或《=》操作符的等式比较（但很快）。优化器不适用hash索引来加速order by操作。

## 锁机制和事务控制
InnoDB的存储引擎提供行级锁，支持共享锁和排他锁两种锁定模式，以及四种不同的隔离级别。

InnoDB自动检测事务的死锁，并回滚一个或几个事务来防止死锁。

InnoDB不能在MySQL lock tables设定表锁定的地方或者涉及InnoDB之外的存储引擎设置锁定的地方检测死锁。

MySQL通过set autocommit，start transaction，commit和rollback等语句支持本地事务。
